---
title: è¯»ä¹¦ç¬”è®°-JSå‡½æ•°å¼ç¼–ç¨‹
date: 2020-12-11 09:45:35
updated:
tags: book
categories: 
- webå‰ç«¯
---
è¿‘çŠ¶, å·¥ä½œå‡ æœˆ, ç»éªŒå‡ å¤©ã€‚ é‡å¤å¤„ç†æˆ‘å¸æ—§é¡¹ç›®CRMä¸šåŠ¡éœ€æ±‚, ä¹Ÿæ›¾è€ƒè™‘é‡æ„, å¥ˆä½•æ¡ä»¶ä¸å…è®¸ã€‚é‚è¯»ä¹¦, å¯»æ±‚çªç ´ã€‚æ„Ÿè§‰é€šç¯‡åœ¨æµæ°´, ä½†å¸Œæœ›é€šè¿‡è¿™ç§æ–¹å¼èƒ½è®©è‡ªå·±å¯¹æŸäº›æ€æƒ³ç†è§£æ›´åŠ æ·±åˆ».

```md
å‡½æ•°å¼ç¼–ç¨‹çš„å“²å­¦å°±æ˜¯å‡å®šå‰¯ä½œç”¨æ˜¯é€ æˆä¸æ­£å½“è¡Œä¸ºçš„ä¸»è¦åŸå› ã€‚
åªè¦æ˜¯è·Ÿå‡½æ•°å¤–éƒ¨ç¯å¢ƒå‘ç”Ÿçš„äº¤äº’å°±éƒ½æ˜¯å‰¯ä½œç”¨ã€‚
æˆ‘ä»¬ä¸èƒ½æ¶ˆé™¤å‰¯ä½œç”¨, ä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶å‰¯ä½œç”¨, é€šè¿‡å‡½æ•°å¼ç¼–ç¨‹
```
## 1. å‡½æ•°çœŸçš„æ²¡ä»€ä¹ˆç‰¹æ®Š
```md
å‡½æ•°çœŸæ²¡ä»€ä¹ˆç‰¹æ®Šçš„ï¼Œä½ å¯ä»¥åƒå¯¹å¾…ä»»ä½•å…¶ä»–æ•°æ®ç±»å‹ä¸€æ ·å¯¹å¾…å®ƒä»¬â€”â€”æŠŠå®ƒä»¬å­˜åœ¨æ•°ç»„é‡Œï¼Œå½“ä½œå‚æ•°ä¼ é€’ï¼Œèµ‹å€¼ç»™å˜é‡...ç­‰ç­‰
```
è¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è¯´çš„, é«˜é˜¶å‡½æ•°, è´´åˆå¹³æ—¶ä½¿ç”¨çš„å›è°ƒå‡½æ•°, ç»™å‡½æ•°ä¼ é€’å‡½æ•°å‚æ•°, å‡½æ•°è¿”å›å‡½æ•°ç­‰åœºæ™¯
ä½†æ˜¯, **ä¼ é€’å‡½æ•°çš„åŒæ—¶, åº”å½“æ³¨é‡å‡½æ•°çš„ "æ‰“å¼€æ–¹å¼"**
```js
// çœ‹èµ·æ¥é…·ç‚«, å®åˆ™æ— ç”¨
var getServerStuff = cb => ajaxCall(json => cb(json));

var getServerStuff = ajaxCall
```
## 2. çº¯å‡½æ•°:å‡å°‘å‡½æ•°å‰¯ä½œç”¨
```md
çº¯å‡½æ•°æ˜¯è¿™æ ·ä¸€ç§å‡½æ•°ï¼Œå³ç›¸åŒçš„è¾“å…¥ï¼Œæ°¸è¿œä¼šå¾—åˆ°ç›¸åŒçš„è¾“å‡ºï¼Œè€Œä¸”*æ²¡æœ‰ä»»ä½•å¯è§‚å¯Ÿçš„å‰¯ä½œç”¨*ã€‚
```
**ç®€å•ç†è§£, ä¸è¢«å¤–ç•Œå½±å“, è¾“å…¥ä¸è¾“å‡ºä¹‹é—´å”¯ä¸€æ˜ å°„**
ä¸‹é¢ä¸¤æ®µä»£ç çš„åŒºåˆ«åœ¨äº: æ¯”è¾ƒçš„minimumå€¼æ˜¯å¦å¯è¢«ç³»ç»Ÿæ”¹å˜ã€‚
```js
// ä¸çº¯çš„å‡½æ•°
var minimum = 21;
var checkAge = function(age) {return age >= minimum;};
```
```js
// çº¯å‡½æ•°
var checkAge = function(age) {var minimum = 21;return age >= minimum;};
```
**ç¼–å†™çº¯å‡½æ•°åº”è¯¥æ˜ç¡®ä¾èµ–, å³ä»å½¢å‚ä¾¿å¯çœ‹å‡ºæ­¤å‡½æ•°çš„ä¾èµ–**, å³ä¼ å…¥çš„å¤–éƒ¨çŠ¶æ€åº”å½“åœ¨å½¢å‚ä¸­å®šä¹‰
```js
// ä¸çº¯çš„
var signUp = function(attrs) {
  var user = saveUser(attrs);  welcomeUser(user);
};
var saveUser = function(attrs) {
  var user = Db.save(attrs);    
};
var welcomeUser = function(user) {    
  Email(user, ...);    
};
// çº¯çš„
var signUp = function(Db, Email, attrs) {
  return function() {
    var user = saveUser(Db, attrs);    
    welcomeUser(Email, user);  
  };
};
var saveUser = function(Db, attrs) { ...};
var welcomeUser = function(Email, user) {    ...};
```

## 3. curry and compose
### 3.1 curry
```md
åªä¼ é€’ç»™å‡½æ•°ä¸€éƒ¨åˆ†å‚æ•°æ¥è°ƒç”¨å®ƒï¼Œè®©å®ƒè¿”å›ä¸€ä¸ªå‡½æ•°å»å¤„ç†å‰©ä¸‹çš„å‚æ•°ã€‚
```
è¿™é‡Œæ¨èä¸€ä¸ªå¤§ç¥çš„åšå®¢, ä¾¿äºç†è§£[å‡½æ•°æŸ¯é‡ŒåŒ–](https://github.com/mqyqingfeng/Blog/issues/42), å‡½æ•°æŸ¯é‡ŒåŒ–, ç”¨ä¹ æƒ¯äº†å°±å¾ˆä¾èµ–, ä½†æ˜¯æˆ‘å¸é¡¹ç›®æ²¡æœ‰èº«å½±
*è¿™é‡ŒæŠŠè¦æ“ä½œçš„æ•°æ®æ”¾åˆ°æœ€åä¸€ä¸ªå‚æ•°*, åˆ©äº`compose`
```js
var curry = require('lodash').curry
var match = curry(function(what, str) {
  return str.match(what)
})
var replace = curry(function(what, replacement, str) {
  return str.replace(what, replacement)
})
var findSpace = match(/\s+/g) // é€šè¿‡ä¼ å…¥ä¸åŒçš„æ­£åˆ™å¾—åˆ°ä¸åŒçš„åŒ¹é…å‡½æ•°
var map = curry(function(f, ary) {
  return ary.map(f)
})
```

### 3.2 compose
```js
// ä»£ç ä»å³å¾€å·¦è¿›è¡Œ
var compose = function(f, g) {
  return function(x) {
    return f(g(x))
  }
}
```
**pointfreeæ¨¡å¼: ä¸å¿…å‘Šè¯‰æˆ‘ä½ æ˜¯è°(æ•°æ®)**
```md
pointfree: å‡½æ•°æ— é¡»æåŠå°†è¦æ“ä½œçš„æ•°æ®æ˜¯ä»€ä¹ˆæ ·çš„
```
```js
  var toUpperCase = function(x) { return x.toUpperCase(); };
  // é pointfreeï¼Œå› ä¸ºæåˆ°äº†æ•°æ®ï¼šword
  var snakeCase = function (word) {
    return word.toLowerCase().replace(/\s+/ig, '_');
  };
  // pointfree
  var snakeCase = compose(replace(/\s+/ig, '_'), toLowerCase);
```
ä¹ æƒ¯äº†å‘½ä»¤å¼å‡½æ•°, å†çœ‹è¿™ç§å£°æ˜å¼å‡½æ•°çš„å†™æ³•è¿™ä¸ªåå·®è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œä½†æ˜¯æ€»çš„æ¥ç€ï¼Œè¿™ç§å‡½æ•°å†™æ³•æ›´åŠ ä¼˜é›…ï¼Œæ˜“è¯»æ€§æ›´é«˜ï¼Œå½“ç„¶è¿™æ˜¯å»ºç«‹åœ¨å‡½æ•°å‘½åç®€å•æ˜“æ‡‚çš„å‰æä¸‹(å½“ç„¶ï¼Œæœ‰å‡½æ•°ç­¾åæ›´å¥½)

**composeå‡½æ•°çš„debugæ–¹æ³•: traceå‡½æ•°**
<font size=2>é€šè¿‡`trace`å‡½æ•°å¯ä»¥çŸ¥é“æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„å€¼</font>
```js
var trace = curry(function(tag, x){console.log(tag, x);return x;});
// after split [ 'The', 'world', 'is', 'a', 'vampire' ]
var dasherize = compose(join('-'),map(toLower),trace("after split"),split(' '),replace(/\s{2,}/ig, ' '));
```

### 3.3 çº¿ä¸Šä¾‹å­
[è·å–ğŸ±çš„å›¾ç‰‡æ˜¾ç¤ºåœ¨ç½‘é¡µä¸Š](https://codesandbox.io/s/js-hanshushibiancheng-3qb2z?file=/src/index.js)
**compose+ curry**çš„ç»„åˆæ„Ÿè§‰æ˜¯æ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„ç²¾ç²¹å§, å¯ä»¥ä¹ æƒ¯ä½¿ç”¨è¿™ç§å†™æ³•


## 4. Hindley-Milnerç±»å‹ç­¾å
```md
ç®€å•æ˜“è¯»çš„å‡½æ•°æ³¨é‡Š, æš´éœ²å‡½æ•°çš„è¡Œä¸ºä¸ç›®çš„
```
```js
// sayHi :: String -> String è¿™ä¸ªStringå¯ä»¥éšä¾¿å‘½åè¡¨ç¤ºæŸç§ç±»å‹çš„å€¼
var sayHi = (str) => {alert(str)};
// id :: a -> a
var id = function(x) {return x};
```
```js
// map :: (a -> b) -> [a] -> b
var map = curry(function(f, xs) {
  return xs.map(f)
})

// reduce :: (b -> a -> b) -> b -> [a] -> b
var reduce = curry(function(f, x, xs) {
  return xs.reduce(f, x)
})
```
```md
**mapå‡½æ•°ç±»å‹è§£è¯»:**
  - mapå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°fæ˜¯ä¸€ä¸ªå‡½æ•°, æ¥æ”¶ç±»å‹açš„å‚æ•°(æ­¤æ•°æ®æ¥æºäºmapå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°aæ•°ç»„)ï¼Œè¿”å›ç±»å‹b
  - mapå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªaç±»å‹æ•°ç»„, æ­¤å‚æ•°ä¼šä¼ é€’ç»™å‡½æ•°fä½œä¸ºå‚æ•°
  - mapå‡½æ•°è¿”å›çš„æ˜¯ b ç±»å‹çš„æ•°æ®

**reduceå‡½æ•°ç±»å‹è§£è¯»:**
  - ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°, æ­¤å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°, b,a, è¿™ä¸¤ä¸ªå‚æ•°æ¥æºäºreduceå‡½æ•°çš„ç¬¬äºŒåŠç¬¬ä¸‰ä¸ªå‚æ•°
  - è¿”å›b
```

## 5. END
æ­¤ä¹¦åé¢è¿˜æåˆ°äº†functorä¹‹ç±»çš„æ¦‚å¿µ, ä¸ªäººè§‰å¾—ç°é˜¶æ®µéš¾ä»¥æ–½å±•.
ä¸€äº›æ”¶è·: ä¸ªäººè§‰å¾— Hindley-Milnerç±»å‹ç­¾åçœŸçš„æ˜¯æ­¤ä¹¦ç»™æˆ‘æœ€å¤§çš„æ”¶è·, å½“ç„¶å‡½æ•°æŸ¯é‡ŒåŒ–ä¹Ÿæ˜¯JSä¸­çš„é»‘é­”æ³• 
**è¯»è¿‡çš„ä¹¦ä¹Ÿè®¸ä¼šå¿˜æ‰, ä½†æ˜¯æ”¶è·çš„å´æ˜¯æ€æƒ³**, åŠªåŠ›å§, æ‰“å·¥äºº


